<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>San Valent√≠n</title>
<style>
    body {
        margin: 0;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background: linear-gradient(135deg, #ffebee 0%, #ffcccb 40%, #ff80ab 70%, #e91e63 100%);
        font-family: Arial, sans-serif;
        overflow: hidden;
        position: relative;
    }
    .heart-rain {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
        overflow: hidden;
    }
    .heart {
        position: absolute;
        font-size: 20px;
        color: #ff69b4;
        opacity: 0.7;
        top: -50px;
        will-change: transform;
        animation: rain linear infinite;
    }
    .heart:nth-child(odd) { 
        color: #c2185b; 
        font-size: 18px; 
    }
    .heart:nth-child(3n) { 
        color: #ff80ab; 
        font-size: 25px; 
        opacity: 0.9; 
    }
    @keyframes rain {
        0% { 
            transform: translateY(0) rotate(0deg); 
            opacity: 0;
        }
        10% {
            opacity: 0.7;
        }
        90% {
            opacity: 0.7;
        }
        100% { 
            transform: translateY(calc(100vh + 100px)) rotate(720deg); 
            opacity: 0;
        }
    }
    .card {
        background: white;
        padding: 40px;
        border-radius: 25px;
        box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        text-align: center;
        width: 420px;
        max-width: 90%;
        position: relative;
        z-index: 10;
        overflow: hidden;
    }
    h1 {
        color: #c2185b;
        font-size: 28px;
        margin-bottom: 10px;
    }
    #textoNo {
        display: none;
        color: #d81b60;
        font-weight: bold;
        margin-top: 15px;
        font-size: 18px;
    }
    img {
        border-radius: 15px;
        margin: 20px auto;
        display: block;
    }
    #imgGif {
        width: 232px !important;
        height: 234px !important;
        object-fit: contain;
        background: #fff;
    }
    .btn-container {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-top: 30px;
    }
    button {
        padding: 14px 35px;
        font-size: 20px;
        font-weight: bold;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: transform 0.4s ease, opacity 0.8s ease;
        position: relative;
    }
    #btnSi {
        background-color: #f06292;
        color: white;
    }
    #btnNo {
        background-color: #90a4ae;
        color: white;
        position: relative;
        transition: left 0.5s ease-out, top 0.5s ease-out, transform 0.3s ease;
        pointer-events: auto;
        z-index: 999;
    }
    #btnNo.moving {
        transition: left 0.25s linear, top 0.25s linear, transform 0.3s ease;
        position: fixed !important;
    }
    .mini-si {
        position: absolute;
        font-size: 1.4rem;
        font-weight: bold;
        color: #f06292;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        pointer-events: none;
        z-index: 1000;
        animation: flyOut 4s forwards;
    }
    @keyframes flyOut {
        0% { opacity: 1; transform: scale(0.6) translate(0,0); }
        100% { opacity: 0; transform: scale(2) translate(var(--tx), var(--ty)); }
    }
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
        20%, 40%, 60%, 80% { transform: translateX(10px); }
    }
    .card-content {
        position: relative;
    }
    .card-content.shake {
        animation: shake 0.5s ease-in-out;
    }
    .btn-si-flood {
        position: absolute;
        padding: 8px 18px;
        font-size: 14px;
        font-weight: bold;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        color: white;
        z-index: 500;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        will-change: transform, opacity;
        animation: fireworkExplosion 2.5s ease-out forwards;
    }
    @keyframes fireworkExplosion {
        0% { transform: translate(0, 0) scale(0.3) rotate(0deg); opacity: 0; }
        20% { transform: translate(calc(var(--explode-x) * 0.2), calc(var(--explode-y) * 0.2)) scale(0.6) rotate(72deg); opacity: 1; }
        40% { transform: translate(calc(var(--explode-x) * 0.5), calc(var(--explode-y) * 0.5)) scale(0.8) rotate(144deg); }
        60% { transform: translate(calc(var(--explode-x) * 0.8), calc(var(--explode-y) * 0.8)) scale(1) rotate(216deg); }
        80% { transform: translate(calc(var(--explode-x) * 1.1), calc(var(--explode-y) * 1.1)) scale(1.1) rotate(288deg); }
        100% { transform: translate(var(--final-x), var(--final-y)) scale(1) rotate(var(--rotate)); opacity: 1; }
    }
</style>
</head>
<body>
<div class="heart-rain" id="heartRain"></div>
<div class="card">
    <div class="card-content">
        <h1 id="titulo">¬øQuieres ser mi San Valent√≠n? ‚ù§Ô∏è</h1>
        <p id="textoNo"></p>
      
        <img
            id="imgGif"
            src="https://i.ibb.co/Gfkxj1m/Grabacindepantalla2026-02-08212818-ezgif-com-video-to-gif-converter.gif"
            alt="Gif inicial"
        >
    </div>
  
    <div class="btn-container">
        <button id="btnSi">¬°S√ç!</button>
        <button id="btnNo">No</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<script>
// Funci√≥n para lanzar confetti
function lanzarConfetti() {
    const duracion = 3000;
    const fin = Date.now() + duracion;

    const colores = ['#f06292', '#ec407a', '#e91e63', '#c2185b', '#ff80ab', '#ff4081'];

    (function frame() {
        confetti({
            particleCount: 5,
            angle: 60,
            spread: 55,
            origin: { x: 0 },
            colors: colores
        });
        confetti({
            particleCount: 5,
            angle: 120,
            spread: 55,
            origin: { x: 1 },
            colors: colores
        });

        if (Date.now() < fin) {
            requestAnimationFrame(frame);
        }
    }());
}

// Lluvia de corazones mejorada
const heartRain = document.getElementById("heartRain");

function createHeart() {
    const heart = document.createElement("div");
    heart.className = "heart";
    heart.innerHTML = "‚ù§Ô∏è";
    heart.style.left = Math.random() * 100 + "%";
    heart.style.animationDuration = (Math.random() * 4 + 6) + "s";
    heart.style.animationDelay = Math.random() * 5 + "s";
    
    const randomOpacity = Math.random() * 0.4 + 0.4;
    heart.style.opacity = randomOpacity;
    
    const randomSize = Math.random() * 15 + 15;
    heart.style.fontSize = randomSize + "px";
    
    heartRain.appendChild(heart);
    
    const duration = parseFloat(heart.style.animationDuration) * 1000 + parseFloat(heart.style.animationDelay) * 1000;
    setTimeout(() => {
        heart.remove();
    }, duration);
    setTimeout(createHeart, Math.random() * 2000); // Recrear con delay aleatorio para flujo continuo
}

for (let i = 0; i < 50; i++) {
    setTimeout(createHeart, i * 100); // Iniciar escalonadamente
}

const btnNo = document.getElementById("btnNo");
const btnSi = document.getElementById("btnSi");
const textoNo = document.getElementById("textoNo");
const imgGif = document.getElementById("imgGif");
const cardContent = document.querySelector(".card-content");

let escalaSi = 1;
let escalaNo = 1;
let primeraVez = true;
let contadorNo = 0;
let isMovingMode = false;
let moveInterval = null;
let gyroActive = false;
let buttonsReady = false;

function shakeCard() {
    cardContent.classList.add('shake');
    setTimeout(() => {
        cardContent.classList.remove('shake');
    }, 500);
}

function createMiniSi(x, y) {
    const miniSi = document.createElement('div');
    miniSi.className = 'mini-si';
    miniSi.textContent = '¬°S√≠!';
    miniSi.style.left = `${x}px`;
    miniSi.style.top = `${y}px`;
    const tx = (Math.random() - 0.5) * 200;
    const ty = (Math.random() - 0.5) * 200 - 100; // Ligeramente hacia arriba
    miniSi.style.setProperty('--tx', `${tx}px`);
    miniSi.style.setProperty('--ty', `${ty}px`);
    document.body.appendChild(miniSi);
    setTimeout(() => miniSi.remove(), 4000);
}

function activarNo(e) {
    if (e) e.preventDefault();
    contadorNo++;
    textoNo.style.display = "block";
    
    shakeCard();

    // Crear mini "S√≠" volando desde el bot√≥n No
    const rect = btnNo.getBoundingClientRect();
    createMiniSi(rect.left + rect.width / 2, rect.top + rect.height / 2);

    if (contadorNo >= 5) {
        imgGif.src = "https://i.ibb.co/bjp4FSRr/STK-20240720-WA0017.webp";
        textoNo.innerHTML = "Solo bot√≥n S√≠ disponible üíï";
        imgGif.style.opacity = '1';
    } else if (contadorNo >= 4) {
        imgGif.src = "https://i.ibb.co/b560P9cq/Grabacin2026-02-08233029-ezgif-com-video-to-gif-converter.gif";
        textoNo.innerHTML = "¬°YA BASTA POR FAVOR! üò≠üíî";
    } else if (contadorNo >= 3) {
        textoNo.innerHTML = "¬°YA BASTA! üíî ¬°AHORA TEN√âS QUE ATRAPARME! üî•";
        imgGif.src = "https://i.ibb.co/C5dZstcx/Grabacindepantalla2026-02-08212636-ezgif-com-video-to-gif-converter.gif";
        if (!isMovingMode) activarModoMovimientoLibre();
    } else if (contadorNo >= 2) {
        textoNo.innerHTML = "¬øPOR QU√â DECIS NO TODAVIA? üò≠üíî";
        imgGif.src = "https://i.ibb.co/C5dZstcx/Grabacindepantalla2026-02-08212636-ezgif-com-video-to-gif-converter.gif";
    } else {
        textoNo.innerHTML = "¬øPOR QU√â APRET√ÅS EL NO? üò≠";
        imgGif.src = "https://i.ibb.co/C5dZstcx/Grabacindepantalla2026-02-08212636-ezgif-com-video-to-gif-converter.gif";
    }

    // Resetear animaci√≥n de imagen
    imgGif.style.opacity = '0';
    imgGif.style.transition = 'opacity 0.3s';
    setTimeout(() => {
        imgGif.style.opacity = '1';
    }, 10);

    escalaSi = escalaSi * 1.30;
    btnSi.style.transform = `scale(${escalaSi})`;

    if (contadorNo >= 5) {
        // Hacer desaparecer completamente el bot√≥n No
        btnNo.style.opacity = '0';
        btnNo.style.pointerEvents = 'none';
        btnNo.style.transition = 'opacity 0.5s ease';
        if (moveInterval) clearInterval(moveInterval);

        // Explosi√≥n del bot√≥n S√≠
        btnSi.style.transform = `scale(0)`;
        btnSi.style.opacity = '0';
        btnSi.style.transition = 'transform 0.3s ease-out, opacity 0.3s ease-out';
        btnSi.style.pointerEvents = 'none';

        setTimeout(() => {
            buttonsReady = true;
            requestGyroPermission();
            explotarBotonesSi();
        }, 300);
    } else {
        escalaNo = Math.max(0.3, escalaNo * 0.80);
        btnNo.style.transform = `scale(${escalaNo})`;
    }

    if (primeraVez && contadorNo >= 1) {
        btnNo.style.position = "fixed";
        btnNo.style.left = (window.innerWidth / 2 - btnNo.offsetWidth / 2) + 'px';
        btnNo.style.top = (window.innerHeight / 2 + 80) + 'px';
        primeraVez = false;
    }

    if (!isMovingMode && contadorNo < 3) {
        const x = Math.random() * (window.innerWidth - btnNo.offsetWidth - 100) + 50;
        const y = Math.random() * (window.innerHeight - btnNo.offsetHeight - 100) + 50;
        btnNo.style.left = `${x}px`;
        btnNo.style.top = `${y}px`;
    }
}

function explotarBotonesSi() {
    const card = document.querySelector('.card');
    const cardRect = card.getBoundingClientRect();
    
    const colores = ['#f06292', '#ec407a', '#e91e63', '#c2185b', '#ff80ab', '#ff4081', '#d81b60'];
    
    // Reducir a 100 botones para mejor rendimiento
    for (let i = 0; i < 100; i++) {
        setTimeout(() => {
            const btnFlood = document.createElement('button');
            btnFlood.className = 'btn-si-flood';
            btnFlood.textContent = '¬°S√ç!';
            
            btnFlood.style.backgroundColor = colores[Math.floor(Math.random() * colores.length)];
            
            // Origen aleatorio dentro de la tarjeta
            const randomOriginX = Math.random() * cardRect.width;
            const randomOriginY = Math.random() * (cardRect.height - 50);
            
            btnFlood.style.left = randomOriginX + 'px';
            btnFlood.style.top = randomOriginY + 'px';
            
            // Direcci√≥n aleatoria
            const angle = Math.random() * 360 * (Math.PI / 180);
            const explodeDistance = 100 + Math.random() * 200;
            
            const explodeX = Math.cos(angle) * explodeDistance;
            const explodeY = Math.sin(angle) * explodeDistance;
            
            // Posici√≥n final con gravedad simulada
            const finalX = explodeX * (0.5 + Math.random() * 0.5);
            const finalY = cardRect.height - randomOriginY + explodeY * 0.3 + 20;
            
            const rotation = Math.random() * 720 - 360;
            
            btnFlood.style.setProperty('--explode-x', `${explodeX}px`);
            btnFlood.style.setProperty('--explode-y', `${explodeY}px`);
            btnFlood.style.setProperty('--final-x', `${finalX}px`);
            btnFlood.style.setProperty('--final-y', `${finalY}px`);
            btnFlood.style.setProperty('--rotate', `${rotation}deg`);
            
            btnFlood.style.animationDelay = (i * 0.01) + 's';
            btnFlood.style.animationDuration = (1.5 + Math.random() * 1) + 's';
            
            btnFlood.addEventListener('click', aceptarSi);
            
            card.appendChild(btnFlood);
        }, i * 10);
    }
}

function activarModoMovimientoLibre() {
    isMovingMode = true;
    btnNo.classList.add('moving');
    let dx = (Math.random() > 0.5 ? 1 : -1) * (150 + Math.random() * 150);
    let dy = (Math.random() > 0.5 ? 1 : -1) * (80 + Math.random() * 80);
    
    let velocidadMultiplicador = 2.35;
    
    moveInterval = setInterval(() => {
        if (!isMovingMode) return;
        let currentLeft = parseFloat(btnNo.style.left) || window.innerWidth / 2;
        let currentTop = parseFloat(btnNo.style.top) || window.innerHeight / 2;
        currentLeft += dx * 0.016 * velocidadMultiplicador;
        currentTop += dy * 0.016 * velocidadMultiplicador;
        if (currentLeft < 30 || currentLeft > window.innerWidth - btnNo.offsetWidth - 30) dx = -dx;
        if (currentTop < 30 || currentTop > window.innerHeight - btnNo.offsetHeight - 30) dy = -dy;
        if (Math.random() < 0.06) {
            dx = (Math.random() > 0.5 ? 1 : -1) * (140 + Math.random() * 140);
            dy = (Math.random() > 0.5 ? 1 : -1) * (70 + Math.random() * 90);
        }
        btnNo.style.left = `${Math.max(30, Math.min(window.innerWidth - btnNo.offsetWidth - 30, currentLeft))}px`;
        btnNo.style.top = `${Math.max(30, Math.min(window.innerHeight - btnNo.offsetHeight - 30, currentTop))}px`;
    }, 16); // Mejor frame rate
}

function requestGyroPermission() {
    if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
        const permitBtn = document.createElement('button');
        permitBtn.textContent = 'üì± Toca para activar movimiento';
        permitBtn.style.cssText = 'position:fixed; bottom:20px; left:50%; transform:translateX(-50%); z-index:9999; padding:12px 24px; background:#f06292; color:white; border:none; border-radius:12px; font-size:16px; font-weight:bold; box-shadow: 0 4px 8px rgba(0,0,0,0.2);';
        document.body.appendChild(permitBtn);
        
        permitBtn.addEventListener('click', () => {
            DeviceMotionEvent.requestPermission()
                .then(response => {
                    if (response === 'granted') {
                        startGyroscope();
                        permitBtn.remove();
                    }
                })
                .catch(console.error);
        });
    } else {
        startGyroscope();
    }
}

function startGyroscope() {
    gyroActive = true;
    
    window.addEventListener('deviceorientation', (event) => {
        if (!gyroActive || !buttonsReady) return;
        
        const gamma = event.gamma || 0;
        const beta = event.beta || 0;
        
        const moveX = (gamma / 90) * 30; // Sensibilidad reducida
        const moveY = (beta / 180) * 30;
        
        const buttons = document.querySelectorAll('.btn-si-flood');
        buttons.forEach(btn => {
            btn.style.transform = `translate(${moveX}px, ${moveY}px) rotate(var(--rotate))`;
            btn.style.transition = 'transform 0.1s ease-out';
        });
    });
}

function aceptarSi() {
    if (moveInterval) clearInterval(moveInterval);
    gyroActive = false;
    lanzarConfetti();
    document.body.innerHTML = `
        <h1 style="color:#c2185b; text-align:center; margin-top:40vh; font-size:3em; text-shadow: 2px 2px 10px rgba(194,24,91,0.5); animation: pulse 1s ease-in-out infinite;">
            ¬°SAB√çA QUE DIR√çAS QUE S√ç! üòç‚ù§Ô∏è
        </h1>
        <style>
            @keyframes pulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.05); }
            }
        </style>
    `;
}

btnNo.addEventListener("click", activarNo);
btnNo.addEventListener("touchstart", activarNo);

btnSi.addEventListener("click", aceptarSi);
btnSi.addEventListener("touchstart", (e) => {
    e.preventDefault();
    aceptarSi();
});

// Manejar resize para posiciones
window.addEventListener('resize', () => {
    if (isMovingMode) {
        btnNo.style.left = Math.min(parseFloat(btnNo.style.left), window.innerWidth - btnNo.offsetWidth - 30) + 'px';
        btnNo.style.top = Math.min(parseFloat(btnNo.style.top), window.innerHeight - btnNo.offsetHeight - 30) + 'px';
    }
});

</script>
</body>
</html>
